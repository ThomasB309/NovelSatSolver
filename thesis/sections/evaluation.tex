%% LaTeX2e class for student theses
%% sections/evaluation.tex
%% 
%% Karlsruhe Institute of Technology
%% Institute for Program Structures and Data Organization
%% Chair for Software Design and Quality (SDQ)
%%
%% Dr.-Ing. Erik Burger
%% burger@kit.edu
%%
%% Version 1.3.5, 2020-06-26

\chapter{Evaluation}
\label{ch:Evaluation}

This chapter will focus on the performance evaluation of our novel SAT solver architecture. First we will talk about how the different benchmarks for this evaluation were created. Then we will look at how our SAT solver performs in comparison to other modern state of the art SAT solvers.

\section{Benchmarks}

In order to assess how good our novel SAT solver architecture performs, it is important to chose the correct benchmarks. Similar to other modern SAT solvers, our solver is capable of solving formulas that are represented as a CNF in a DIMACS file. Because SAT solving has a long history, there are a large amount of CNF benchmarks that can be used for a comparison in this area. While this evaluation will also contain performance comparisons on these CNF benchmarks, it isn't the focus of this thesis. As already described, this thesis tries to investigate if the structure of AMO and DNF constraints can be leveraged in order to gain an advantage compared to pure CNF solving. That's why our comparison is mostly focused on how fast our solver can solve benchmarks that contain these new constraints, compared to how fast other modern SAT solvers can solve the pure CNF equivalents. So in order to make this comparison possible, we implemented a program that converts benchmarks with AMO and DNF constraints to equivalent formulas in their CNF form.

\section{Encoding of AMO constraints}

Other modern SAT solvers were always capable of solving formulas that contained AMO and DNF constraints indirectly. Instead of supporting them natively, like our SAT solver, they just used an encoding in order to represent these constraints as a CNF. So in order to convert our benchmarks to their CNF equivalents, we just have to encode every AMO and DNF constraint. This isn't a simple task because there are many different encodings that have different strengths.

\paragraph{AMO constraints with a single literal}

This case is very simple, because AMO constraints that only contain a single literal, are actually always satisfied. An AMO constraint is satisfied if and only if at most one of its literals are true. Because it only contains a single literal, there can only ever be at most one literal that is true. This constraint is therefore redundant and can actually be removed

\paragraph{AMO constraints with less than six literals}

It was shown (find a source??) that for AMO constraints with less than six literals, the naive pairwise encoding hast the best performance.

\begin{figure}[h!t]
\label{form:pairwiseAMO}
\centering
\begin{leftbar}
\begin{displaymath}
AMO(x_1,...,x_n) = \bigwedge_{i=1}^{n - 1} \bigwedge_{j=i+1}^{n} \neg x_i \vee \neg x_j
\end{displaymath}
\end{leftbar}
\caption{Pairwise AMO encoding}
\end{figure}

Formula \ref{form:pairwiseAMO} shows the pairwise AMO encoding that is used for AMO constraints with less than six literals. The following example shows an AMO constraint with three literals and its CNF equivalent:

\begin{leftbar}
\begin{displaymath}
AMO(a,b,\neg c) \rightarrow (\neg a \vee \neg b) \wedge (\neg a \vee c) \wedge (\neg b \vee c)
\end{displaymath}
\end{leftbar}

\paragraph{AMO constraints with six or more literals}

For AMO constraints with six or more literals it is more efficient to use the sequential encoding which was introduced in the paper "Towards an Optimal CNF Encoding of
Boolean Cardinality Constraints" \cite{sinz2005towards} by Carsten Sinz. For AMO constraints with n literals it produces an encoding with 3n-4 clauses and n - 1 encoding variables \cite{sinz2005towards}.

\begin{figure}[h!t]
\label{form:sequentialAMO}
\centering
\begin{leftbar}
\begin{displaymath}
AMO(x_1,...,x_n) = (\neg x_1 \vee s_{1,1}) \wedge (\neg x_n \vee \neg s_{n-1,1}) \bigwedge_{1 < i < n} ((\neg x_i \vee s_{i,1}) \wedge (\neg s_{i-1,1} \vee s_{i,1}) \wedge (\neg x_i \vee \neg s_{i-1,1}))
\end{displaymath}
\end{leftbar}
\caption{Sequential AMO encoding \cite{sinz2005towards}}
\end{figure}

Formula \ref{form:sequentialAMO} shows the sequential encoding for AMO constraints. The following example shows how the encoding looks on a practical example:

\begin{leftbar}
\begin{displaymath}
AMO(a,b,\neg c) \rightarrow (\neg a \vee e) \wedge (c \vee f) \wedge (\neg b \vee f) \wedge (\neg e \vee f) \wedge (\neg b \vee \neg e)
\end{displaymath}
\end{leftbar}

Keep in mind that this example shows a sequential encoding for an AMO constraint with three literals. This is just to show how the encoding works. In our evaluation this encoding is only applied to AMO constraints with at least six literals.

\section{Randomized benchmarks}

Because the are no known sets of benchmarks that contain both AMO and DNF constraints in the form that our SAT solver needs, we needed to create our own benchmarks. One of the fastest ways to create benchmarks is a random generator. This has the advantage that it is possible to create very large sets of benchmarks in a short amount of time. But the randomization also makes it hard to control the difficulty of the benchmark. In order to make an accurate assessment on how good our SAT solver performs, we need benchmarks that are hard to solve. The randomization only allows us to control the number of variables, how many variables each constraint contains and how many constraints of each type are in the created formula.

In order to create hard 3-SAT instances it was shown that there occurs a phase transition at a variable to clause ratio of about 4.3 \cite{gent1994sat}. At this ratio about 50\% of the randomized 3-SAT instances are satisfiable. This ratio has a crossover with the point where very hard 3-SAT instances are created by the randomizer. So in order to create hard instances that contain other types of constraints, we decided to investigate if there exists a similar phase transition point for the other constraint types in our solver.

\subsection{Phase transition of AMO constraints}

In order to create hard instances of formulas that only consist of AMO constraints, we use a similar approach to the phase transition examination of CNF formulas. Using the incremental interface of our SAT solver, we solve a set of formulas that only consist of AMO constraints and then calculate which percentage of these formulas is satisfiable. The tool then progressively adds more AMO constraints to the formulas until the percentage of satisfiable constraints reaches zero. We measure the percentage by solving 1000 instances of these formulas.

\input{graphs/AMO_Phase_Transition.tex}

The graph \ref{fig:AMOPhase} shows the relation between the AMO constraint to variable ratio and the percentage of satisfiable constraints as well as the solving speed of 1000 instances. In order to find the phase transition point for formulas that only contain AMO constraints, we created 1000 random formulas and used the solver to determine how many of them were satisfiable. During each iteration we then increased the amount of AMO constraints per formula by five, to see how this affects the percentage of satisfiable constraints. We conducted this experiment with AMO constraints of length two to seven. The results show that every type of AMO constraint, that we conducted the experiment with, has a phase transition. The length of the AMO constraint only has an effect on when the phase transition occurs. An increasing AMO constraint length causes the phase transition to occur earlier. A possible explanation for that an increasing amount of literals per AMO constraint, restricts the space of possible solutions more. This then causes the phase transition to occur earlier. We also measured the time that the solver needs in order to solve the 1000 instances in every iteration. We then normalized these values and added them to the graph. What is interesting is that the the hardest instances seem to be located at around the phase transition point, independent of the number of literals that the AMO constraints have.

\subsection{Phase transition of DNF constraints}

Similar to the phase transition calculation for the AMO constraints, we also conducted experiments for formulas that only contain DNF constraints. Here we used a similar approach to the phase transition experiment for the AMO constraints.

\subsection{DNF constraints with constant amount of terms}

\input{graphs/DNF_Phase_Transition_Constant_Terms.tex}


The graph \ref{fig:DNFConstantTerm} shows the relation between the DNF constraint to variable ratio to the percentage of satisfiable constraints, as well as the normalized solving time of 1000 instances. The dotted lines show the normalized solving time, while the continuous lines show the percentage of satisfiable constraints. Here we used DNF constraints with three terms, 50 variables and increment the amount of DNF per iteration by one. We then conducted the experiment with DNF constraints with a term length of two to seven. For the phase transition we can see a similar behavior to what we have already seen with the AMO constraints. By adding more literals to the terms of the DNF constraints, the space of satisfiable constraints gets restricted, which is probable explanation for why the phase transition occurs later the more literals are added to the terms. What is interesting here is, that the hardest instances of these DNF constraints also seem to occur around their phase transition point.

\subsection{DNF constraints with a constant term length}

In this next experiment we left the number of terms per DNF constraint constant while steadily increasing the amount of literals per term, in order to see the effect that the term length has on the phase transition point.

\input{graphs/DNF_Phase_Transition_Constant_Term_Length.tex}	

The graph \ref{fig:DNFConstantTermLength} shows the relation between the DNF constraint to variable ratio and the percentage of the satisfiable constraints, as well as the normalized solving speed of 1000 instances. We use DNF constraints with a constant term length of five, 25 variables and a DNF increment of one per iteration. For the experiment we used DNF constraints with one to five terms. The dotted lines show the normalized solving time and the continuous lines show the percentage of satisfiable constraints. Here we see the opposite behavior of before. The more terms are added to the constraints, the later the phase transition occurs. A possible explanation for this, is that a higher amount of terms actually widens the space of possible solutions and therefore shift the phase transition point to a later point. The hardest instances also seem to be at around the phase transition point of these DNF constraints.

\section{Phase transition of AMO constraints with a constant number of clauses}

An important aspect of our evaluation is the performance of our solver on formulas that combine the many different constraint types. So in order to create hard benchmarks for this case, we also had to investigate how the phase transition of the constraints is affected, when they are combined with other constraint types in a formula.

\input{graphs/AMO_Phase_Transition_Clauses.tex}	

The graph \ref{fig:AMOClause} shows the relation between the AMO constraint to variables ratio and the percentage of satisfiable constraitns, as well as the normalized solving time of 1000 instances. We used 100 variables and increased the amount of AMO constraints by one per iteration. We then conducted the experiment where the formulas contain 0 to 400 clauses with 3 literals. What can be seen is that a larger amount of clauses shifts the phase transition of the AMO constraints to an earlier point. This is consistent with the information that we already gathered from the earlier experiments. The clauses restrict the space of possible solutions, which in turn causes the phase transition to occur earlier. What is interesting to see, is that the AMO constraints don't have a large impact on the solving time. The hardest instances actually occur when we reach the phase transition point of the clauses.

\section{Phase transition of DNF constraints with a constant number of clauses}

Similar to the phase transition of AMO constraints with a constant number of clauses, we also wanted to investigate how the phase transition of the DNF constraints is affected by an increasing number of clauses.

\input{graphs/DNF_Phase_Transition_Clauses.tex}	

The graph \ref{fig:DNFClauses} shows the relation between the DNF constraint to variable ratio and the percentage of satisfiable constraints. From right to left the graphs show the phase transition with 0, 100, 200, 300 and 400 clauses respectively. Similar to the AMO constraints we can see that the phase transition of the DNF constraints shifts to an earlier point the more clauses are added. We can also see that at 400 clauses, the percentage of satisfiable constraints also starts at about 65\% because we are near the phase transition point for clauses already.

\section{Phase transition of of AMO constraints with DNF constraints}

After conducting experiments with the combination of other constraint types with a constant number of clauses, we also experimented with combining AMO and DNF constraints in order to see how the phase transition is affected

\input{graphs/AMO_Phase_Transition_DNF.tex}

The graph \ref{fig:AMODNF} shows the relation between the AMO constraint to variable ratio and the percentage of satisfiable constraints, as well as the normalized solving time for 1000 instances. We can see a similar behavior to the phase transition of AMO constraints with a constant amount of clauses. By adding more DNF constraints, the solution space gets more restricted, which causes the phase transition to occur earlier. Similar to the clauses we can also see, that the DNF constraints are responsible for a strong increase in the solving time.

\section{Phase transition of AMO constraints with DNF constraints and clauses}

As a final experiment we wanted to see how the all three constraint types interact with each other. In this experiment we again take a lookt at the phase transition of AMO constraints while adding a constant amount of DNF constraints and clauses, in order to see how this affects the phase transition.


\input{graphs/AMO_Phase_Transition_Clauses_DNF.tex}

The graph \ref{fig:AMOClauseDNF} shows the relation between the AMO constraint to variable ratio and the percentage of satisfiable constraints, as well as the normalized solving speed of 1000 instances.
